import discord
from discord.ext import commands
import json
import random
import string

TOKEN = "MTQ3NDAyMzM0MTU3NTc3MDI3Mw.GaDJPI.gaHkf-tczQ5lz4NmYAjFl8JUOAMY8L1vUTECtE"
JSON_FILE = "licenses.json"

intents = discord.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix='/', intents=intents)

# --- Helpers ---
def load_licenses():
    with open(JSON_FILE, "r") as f:
        return json.load(f)

def save_licenses(data):
    with open(JSON_FILE, "w") as f:
        json.dump(data, f, indent=4)

def generate_key():
    key = ''.join(random.choices(string.ascii_uppercase + string.digits, k=16))
    # dodaj myślniki co 4 znaki
    return '-'.join([key[i:i+4] for i in range(0, 16, 4)])

# --- Commands ---
@bot.command()
async def generate(ctx):
    """Generuje nowy klucz"""
    data = load_licenses()
    key = generate_key()
    data[key] = {"hwid": "", "banned": False}
    save_licenses(data)
    await ctx.send(f"Nowy klucz: `{key}`")

@bot.command()
async def ban(ctx, key):
    """Banuje klucz"""
    data = load_licenses()
    if key in data:
        data[key]["banned"] = True
        save_licenses(data)
        await ctx.send(f"Klucz `{key}` został zbanowany")
    else:
        await ctx.send("Nie znaleziono klucza")

@bot.command()
async def reset(ctx, key):
    """Resetuje przypisanie HWID"""
    data = load_licenses()
    if key in data:
        data[key]["hwid"] = ""
        save_licenses(data)
        await ctx.send(f"HWID klucza `{key}` został zresetowany")
    else:
        await ctx.send("Nie znaleziono klucza")

bot.run(TOKEN)
